    <style>
        ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
        }

        li {
            margin-left: 7px;
        }

        .file {
            display: block;
            list-style: none;
        }

        .folder {
            list-style: none;
            cursor: pointer;

            >ul {
                display: none;
            }
        }

        .folder-open {
            >ul {
                display: block;
                padding-left: 15px;
                margin-left: 9px;
                border-left: 2px solid $color-grey;
            }
        }

        .hide {
            display: none;
            position: absolute;
            z-index: 10;
        }

        .show {
            display: block;
            position: absolute;
            z-index: 10;
        }

        .disabled {
            color: grey;
        }
    </style>

    <div id="menu"></div>

    <div class="hide" id="stepmenu" style="border: 5px outset black; background-color: white">
        <a onclick="elementNew()">New</a><br />
        <a onclick="elementRename()">Rename</a><br />
        <a onclick="elementEnableDisable()">Disable/enable</a><br />
        <a onclick="elementDelete()">Delete</a><br />
        <a onclick="stepClone()">Clone</a><br />
    </div>

    <div class="hide" id="foldermenu" style="border: 5px outset black; background-color: white">
        TC
        <a onclick="elementNew()">New</a><br />
        <a onclick="elementRename()">Rename</a><br />
        <a onclick="elementEnableDisable()">Disable/enable</a><br />
        <a onclick="elementDelete()">Delete</a><br />
        <a onclick="tcClone()">Clone</a><br />
	<hr>
        <a onclick="elementNewInside()">New inside</a><br />
    </div>

    <!--TC-->

    <script>
        function getPath(path) {
            var retVal = "";
            for (i = 0; i < path.length; i++) {
                if (retVal != "") retVal += "/";
                retVal += path[i];
            }
            console.log(retVal);
            return retVal;
        }

        function elementRename() {
            let elpath = popupMenuID.split("/");
            let oldName = elpath[elpath.length - 1];

            while (true) {
                var newName = prompt("Please enter unique name", oldName);

                if (newName == null) {
                    break;
                }
                elpath[elpath.length - 1] = newName;
                newElementPath = getPath(elpath);

                if (document.getElementById(newElementPath) == null) {
                    params = new URLSearchParams(window.location.search);
                    executePOST("file=" + params.get("file") + "&" + "op=renameelement&" + "path=" + popupMenuID + "&" + "new=" + newName + "&newpath=" + newElementPath,
                        function(args) {
                            el = document.getElementById(args[0]);
                            el.text = args[1];
                            var toggler = document.getElementsByClassName("tcts");
                            for (var i = 0; i < toggler.length; i++) {
console.log(toggler[i].id+" vs "+popupMenuID);
                                if (toggler[i].id && toggler[i].id.startsWith(popupMenuID)) {
                                    toggler[i].id = toggler[i].id.replace(args[0], args[2]);
                                }
                            }
                            var toggler = document.getElementsByClassName("step");
                            for (var i = 0; i < toggler.length; i++) {
                                if (toggler[i].id && toggler[i].id.startsWith(popupMenuID)) {
                                    toggler[i].id = toggler[i].id.replace(args[0], args[2]);
                                }
                            }
                        },
                        popupMenuID, newName, newElementPath,
                    );
                    break;
                }
            }
            document.getElementById(popupMenuName).classList.toggle("show");
        }

        function elementEnableDisable() {
            params = new URLSearchParams(window.location.search);
            executePOST("file=" + params.get("file") + "&op=enabledisableelement&path=" + popupMenuID,
                function(args) {
                   document.getElementById(args[0]).classList.toggle("disabled");
                }, popupMenuID
            );

            document.getElementById(popupMenuName).classList.toggle("show");
        }

        function elementNew() {
            let oldName = "";
            let elpath = popupMenuID.split("/");

            while (true) {
                var newName = prompt("Please enter unique name", oldName);
                oldName = newName;

                if (newName == null) {
                    break;
                }
                elpath[elpath.length - 1] = newName;
                newElementPath = getPath(elpath);

                if (document.getElementById(newElementPath) == null) {
                    params = new URLSearchParams(window.location.search);
                    executePOST("file=" + params.get("file") + "&" + "op=newelement&" + "path=" + popupMenuID + "&" + "new=" + newName,
                        function(args) {
                            liel = document.createElement("li");
			    if (args[3] == 3) {
                                liel.classList.add ("file");
			    } else {
                                liel.classList.add ("folder", "folder-open");
			    }
                            alel = document.createElement("a");
                            alel.text = args[1];
                            alel.id = args[2];
            		    alel.setAttribute("class", args[3] == 3 ? "step" : "tcts");
                            params = new URLSearchParams(window.location.search);
                            alel.onclick = function() {
                                loadRightPart(
                                    "file=" + params.get("file") + "&path=" + this.id,
                                );
                            };

                            liel.appendChild(alel);

                            el = document.getElementById(args[0]);
                            liparent = el.parentNode;
                            liparent.parentNode.insertBefore(liel, liparent);

			    if (args[3] == 3) {
//                                updateStep(liel);
            			updatePopupMenu(alel, "step");
			    } else {
				updateFolder(liel);
		                updatePopupMenu(alel, "folder");
			    }
                        },
                        popupMenuID,
                        newName,
                        newElementPath,
                        elpath.length,
                    );
                    break;
                }
            }
            document.getElementById(popupMenuName).classList.toggle("show");
        }

        function elementNewInside() {
            let oldName = "";
            let elpath = popupMenuID.split("/");

            while (true) {
                var newName = prompt("Please enter unique name", oldName);
                oldName = newName;

                if (newName == null) {
                    break;
                }
                newElementPath = getPath(elpath)+"/"+newName;

                if (document.getElementById(newElementPath) == null) {
                    params = new URLSearchParams(window.location.search);
                    executePOST("file=" + params.get("file") + "&" + "op=newelementinside&" + "path=" + popupMenuID + "&" + "new=" + newName,
                        function(args) {
                            liel = document.createElement("li");
			    if (args[3] == 2) {
                                liel.classList.add ("file");
			    } else {
                                liel.classList.add ("folder", "folder-open");
			    }
                            alel = document.createElement("a");
                            alel.text = args[1];
                            alel.id = args[2];
            		    alel.setAttribute("class", args[3] == 2 ? "step" : "tcts");
                            params = new URLSearchParams(window.location.search);
                            alel.onclick = function() {
                                loadRightPart(
                                    "file=" + params.get("file") + "&path=" + this.id,
                                );
                            };

                            liel.appendChild(alel);

                            el = document.getElementById(args[0]);
			    el.append(liel);

			    if (args[3] == 2) {
            			updatePopupMenu(alel, "step");
			    } else {
				updateFolder(liel);
		                updatePopupMenu(alel, "folder");
			    }
                        },
                        popupMenuID,
                        newName,
                        newElementPath,
                        elpath.length,
                    );
                    break;
                }
            }
            document.getElementById(popupMenuName).classList.toggle("show");
        }

        function elementDelete() {
            params = new URLSearchParams(window.location.search);
            executePOST(
                "file=" + params.get("file") + "&op=deleteelement&path=" + popupMenuID,
                function(args) {
                    el = document.getElementById(popupMenuID);
                    //fixme for folder also parent parent
                    el.parentNode.remove();
                },
                null,
            );
            document.getElementById(popupMenuName).classList.toggle("show");
        }

        function stepClone(stepName) {
            var x = prompt("Please enter cloned step name");
            if (x != stepName && x != null) {
                http = createPOST();
                http.onload = function() {
                    if (http.status != 200) {
                        alert(http.response);
                    } else {
                        liel = document.createElement("li");
                        liel.class = "file";

                        alel = document.createElement("a");
                        alel.text = x + "(copy)";
                        alel.id = x + "(copy)";
                        alel.addEventListener(
                            "click",
                            (e) => {
                                loadRightPart("file=bela3.json&step=" + x);
                            },
                            false,
                        );
                        alel.class = "step";

                        liel.appendChild(alel);

                        el = document.getElementById(stepName);
                        liparent = el.parentNode;
                        liparent.parentNode.insertBefore(liel, liparent);

//                        updateStep(liel);
                    }
                };

                http.onerror = function() {
                    alert("request error");
                };

                const params = new URLSearchParams(window.location.search);
                http.send("file=" + params.get("file") + "&op=clonestep&old=" + stepName + "&new=" + x);
                document.getElementById(popupMenuName).classList.toggle("show");
            }
        }

        function updatePopupMenu(toggler, name) {
            toggler.addEventListener("contextmenu", (e) => {
                popupMenuID = e.target.id;
                popupMenuName = name+"menu";
                document.getElementById(name + "menu").classList.toggle("show");
                e.preventDefault();
            });
            toggler.addEventListener("mousemove", (e) => {
                if (document.getElementById(name + "menu").classList.contains("show"))
                    return;
                if (!e) e = window.event;
                document.getElementById(name + "menu").style.top = e.pageY + "px";
                document.getElementById(name + "menu").style.left = e.pageX + "px";
            });
        }

        var popupMenuID = "";
        var popupMenuName = "";

function getFolderElement(name, disabled,id) {
            const params = new URLSearchParams(window.location.search);

            let liel1 = document.createElement("li");
            liel1.setAttribute("class", "folder folder-open");

            let alel1 = document.createElement("a");
            alel1.text = name;
            console.log(id + name);
            alel1.setAttribute("id", id + name);
            alel1.setAttribute("class", "tcts" + (disabled ? " disabled" : ""));
            alel1.onclick = function() {
                loadRightPart("file=" + params.get("file") + "&path=" + this.id);
            };

            let ulel1 = document.createElement("ul");

            liel1.appendChild(alel1);
            liel1.appendChild(ulel1);
	    return liel1;
}

function getFileElement(name, name2, disabled,id) {
            const params = new URLSearchParams(window.location.search);

                let liel2 = document.createElement("li");
                liel2.setAttribute("class", "file");

                console.log(id + name + "/" + name2);
                let alel2 = document.createElement("a");
                alel2.text = name2;
                alel2.setAttribute("id", id + name + "/" + name2);
                alel2.setAttribute("class", "step" + (disabled ? " disabled" : ""));
                alel2.onclick = function() {
                    loadRightPart("file=" + params.get("file") + "&path=" + this.id);
                };

                liel2.appendChild(alel2);
	    return liel2;
}

        function addFilesFolders(treeObj, parentDomObj, id) {
            const params = new URLSearchParams(window.location.search);

	    const folderel = getFolderElement(treeObj.name, treeObj.disabled, id);
            parentDomObj.appendChild(folderel);

            treeObj.folders.forEach(function(folder, index) {
                addFilesFolders(folder, folderel.children[1], id + treeObj.name + "/");
            });
            treeObj.files.forEach(function(file, index) {
                folderel.children[1].appendChild(getFileElement(treeObj.name, file.name, treeObj.disabled, id));
            });
        }


	function updateFolder(obj) {
                const node = document.createElement("a");
                node.innerHTML = obj.classList.contains("folder-open") ?
                    "\u25BC " :
                    "\u25B6 ";
                node.addEventListener("click", function() {
                    this.innerHTML = this.innerHTML == "\u25B6 " ? "\u25BC " : "\u25B6 ";
                    this.parentElement.classList.toggle("folder-open");
                });
	        obj.prepend(node);
	}

	function updateAllFolders() {
            var toggler = document.getElementsByClassName("folder");
            for (var i = 0; i < toggler.length; i++) {
		updateFolder(toggler[i]);
            }
            var toggler = document.getElementsByClassName("tcts");
            for (var i = 0; i < toggler.length; i++) {
                updatePopupMenu(toggler[i], "folder");
            }
            var toggler = document.getElementsByClassName("file");
            for (var i = 0; i < toggler.length; i++) {
                updatePopupMenu(toggler[i], "step");
            }
	}

        ulel = document.createElement("ul");
        document.getElementById("menu").appendChild(ulel);
        tree.forEach(function(folder, index) {
            addFilesFolders(folder, ulel, "");
        });

	updateAllFolders();
    </script>
