<br>
<script async=async>
function selectLastDate() {
  http = createPOST();
  http.onload = function() {
    if (http.status != 200) {
      alert(http.response);
    }
    const obj = JSON.parse(http.response);

    document.getElementById("lastrequesturl").value =obj.url;

    document.getElementById("lastrequestheaders").value ="";
    for (var i =0;i<obj.headers.length;i++) {
      document.getElementById("lastrequestheaders").value =
      document.getElementById("lastrequestheaders").value+obj.headers[i]+"\n";
    }
    document.getElementById("lastrequestbody").value  = decodeURIComponent(obj.body);

    document.getElementById("lastresponseheaders").value ="";
    for (var i =0;i<obj.headers_res.length;i++) {
      document.getElementById("lastresponseheaders").value =
      document.getElementById("lastresponseheaders").value+obj.headers_res[i]+"\n";
    }
    document.getElementById("lastresponsebody").value  = decodeURIComponent(obj.body_res);
  }

  http.onerror = function() {
    alert('login error');
  };

//  document.getElementById("lastrequestheaders").value = document.getElementById("header").value;
//  document.getElementById("lastrequestbody").value  = document.getElementById("body").value;
  const params = new URLSearchParams(window.location.search);
  http.send("file="+params.get('file')+"&getstep="+document.getElementById("name").value+"&dt="+encodeURIComponent(document.getElementById("whenlast").value));
  return false;
}

function sendNewStep() {
  http = createPOST();
  http.onload = function() {
    if (http.status != 200) {
      alert(http.response);
    }
    //document.getElementById("lastresponsebody").value = http.response;
    alert('jest odpowiedz '+http.response);
    const obj = JSON.parse(http.response);
    var option = document.createElement("option");
    option.value = obj.datetime;
    option.text = obj.datetime;
    var selObj = document.getElementById("whenlast");
    selObj.prepend(option);

    for (var i = 0; i < selObj.options.length; i++) {
        if (selObj.options[i].text==obj.datetime) {
            selObj.options[i].selected = true;
            break;
        }
    }

    document.getElementById("lastrequesturl").value =obj.url;

    document.getElementById("lastrequestheaders").value ="";
    for (var i =0;i<obj.headers.length;i++) {
      document.getElementById("lastrequestheaders").value =
      document.getElementById("lastrequestheaders").value+obj.headers[i]+"\n";
    }
    document.getElementById("lastrequestbody").value  = decodeURIComponent(obj.body);

    document.getElementById("lastresponseheaders").value ="";
    for (var i =0;i<obj.headers_res.length;i++) {
      document.getElementById("lastresponseheaders").value =
      document.getElementById("lastresponseheaders").value+obj.headers_res[i]+"\n";
    }
    document.getElementById("lastresponsebody").value  = decodeURIComponent(obj.body_res);
  }

  http.onerror = function() {
    alert('login error');
  };

  document.getElementById("lastrequestheaders").value = document.getElementById("header").value;
  document.getElementById("lastrequestbody").value  = document.getElementById("body").value;
  const params = new URLSearchParams(window.location.search);
  http.send("file="+params.get('file')+"&runstep="+document.getElementById("name").value);
  //  http.send("login=1&user=" + sha256(loginhash + user) + "&password=" + sha256(loginhash + sha256(password)));
  return false;
};
</script>
<table><tr><td>
<form onsubmit="return sendNewStep()">
  Name<br><input type="text" id="name" name="name" value="<!--NAME-->" size=61>
  <p><select name="type" id="type">
    <option value="GET">GET</option>
    <option value="POST">POST</option>
  </select> <!--URLPREFIX-->&nbsp;&nbsp;
  <input type="text" id="url" name="url" value="<!--URL-->" size=70>
  <p>Headers<br><textarea cols=80 rows=5 id="header" name="header"><!--HEADER--></textarea>
  <p>Body<br><textarea cols=80 rows=5  id="body" name="body"><!--BODY--></textarea>
  <p><input type="checkbox" id="ignorewrongssl" />Ignore SSL errors
  <p>Asserts
  <p><select name="x" id="x">
    <option value="GET">HTTP code</option>
    <option value="POST">Headers</option>
    <option value="POST">Body</option>
  </select>
  <input type="text" id="url2" name="url2" value="200" size=40>
  <p><button type="submit">Run</button>
</form>
</td><td>
  <p>When <select name="whenlast" id="whenlast" onchange="selectLastDate()">
<!--WHENLAST-->
  </select>
  <p><select name="lastrequesttype" id="type">
    <option value="GET">GET</option>
    <option value="POST">POST</option>
  </select> <!--URLPREFIX-->
  &nbsp;&nbsp;<input type="text" id="lastrequesturl" name="lastrequesturl" value="<!--URL-->" size=61>
  <br>Headers<br><textarea cols=80 rows=5 id=lastrequestheaders></textarea>
  <br>Body<br><textarea cols=80 rows=5 id=lastrequestbody></textarea>
  <br><input type="checkbox" id="lastignorewrongssl" />Ignore SSL errors
  <p>Headers<br><textarea cols=80 rows=5 id=lastresponseheaders></textarea>
  <br>Body<br><textarea cols=80 rows=5 id=lastresponsebody></textarea>
</td></tr></table>
